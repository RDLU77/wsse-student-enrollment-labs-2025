name: OpenAPI Validation CI

on:
  # åƒ…åœ¨ openapi/ è³‡æ–™å¤¾ä¸‹çš„ .yaml æª”æ¡ˆæœ‰ç•°å‹•æ™‚æ‰åŸ·è¡Œ
  pull_request:
    paths: ['openapi/**/*.yaml']
  push:
    branches: [main]

jobs:
  validate:
    runs-on: ubuntu-latest
    steps:
      # 1. å–å¾—ç¨‹å¼ç¢¼
      - name: â¬‡ï¸ Checkout code
        uses: actions/checkout@v4

      # 2. è¨­å®š Node.js ç’°å¢ƒä¸¦å•Ÿç”¨å¿«å– (Caching)
      # å³ä½¿æ˜¯å…¨åŸŸå®‰è£ï¼Œä½¿ç”¨å¿«å–ä¹Ÿèƒ½æå‡æ€§èƒ½ï¼Œä½†æ›´å»ºè­°åœ¨å°ˆæ¡ˆä¸­å®‰è£ã€‚
      - name: âš™ï¸ Setup Node.js and Cache Dependencies
        uses: actions/setup-node@v4
        with:
          node-version: '18'
          # å•Ÿç”¨ npm å¿«å–ï¼ŒåŠ é€Ÿå¾ŒçºŒçš„ npm i/ci
          cache: 'npm' 
          
      # 3. å®‰è£ Redocly CLI 
      # å»ºè­°å°‡ CLI ä½œç‚ºé–‹ç™¼ä¾è³´ (devDependency) åŠ å…¥ package.jsonï¼Œç„¶å¾Œä½¿ç”¨ npm ciã€‚
      # ç‚ºäº†ä¿æŒ Minimal CI ç¯„ä¾‹çš„ç°¡æ½”æ€§ï¼Œé€™è£¡ç¹¼çºŒä½¿ç”¨å…¨åŸŸå®‰è£ (ä½†å·²è½‰æ›è‡³ Redocly)ã€‚
      - name: ğŸ“¦ Install Redocly CLI globally (Recommended alternative)
        run: npm install -g @redocly/cli

      # 4. åŸ·è¡Œ OpenAPI æª”æ¡ˆé©—è­‰ (Validation/Linting)
      # Redocly CLI ä½¿ç”¨ 'lint' æŒ‡ä»¤é€²è¡Œé©—è­‰
      - name: âœ… Validate OpenAPI Specification with Redocly CLI
        # å¦‚æœ openapi.yaml å­˜åœ¨ï¼Œå®ƒæœƒé€²è¡Œé©—è­‰ã€‚
        # å¦‚æœæª”æ¡ˆä¸å­˜åœ¨ï¼Œå‰‡æœƒå‡ºç¾èˆ‡æ‚¨å…ˆå‰ç›¸åŒçš„ã€ŒENOENTã€éŒ¯èª¤ï¼Œ
        # æé†’æ‚¨ openapi/openapi.yaml æª”æ¡ˆç¼ºå¤±ã€‚
        run: redocly lint openapi/openapi.yaml
